{"version":3,"sources":["../../src/pages/images/images.module.ts","../../src/pages/images/images.ts"],"names":[],"mappings":"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","file":"11.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ImagesPage } from './images';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ImagesPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ImagesPage),\r\n  ],\r\n  exports: [\r\n    ImagesPage\r\n]\r\n})\r\nexport class ImagesPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/images/images.module.ts","import { Component, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, AlertController, Tabs } from 'ionic-angular';\r\n\r\nimport { LoopBackConfig } from '../../../shared/sdk';\r\n\r\nimport { ConfigServiceProvider } from '../../providers/config-service/config-service';\r\nimport { PdaparamsServiceProvider } from '../../providers/pdaparams-service/pdaparams-service';\r\nimport { ImageServiceProvider } from '../../providers/image-service/image-service';\r\nimport { ImageFileServiceProvider } from '../../providers/image-file-service/image-file-service';\r\nimport { SiteconfigServiceProvider } from '../../providers/siteconfig-service/siteconfig-service';\r\nimport { SharedServiceProvider } from '../../providers/shared-service/shared-service';\r\nimport { MessageServiceProvider } from '../../providers/message-service/message-service';\r\nimport { LogServiceProvider } from '../../providers/log-service/log-service';\r\n\r\n\r\n/**\r\n * Generated class for the ImagesPage page.\r\n *\r\n * See http://ionicframework.com/docs/components/#navigation for more info\r\n * on Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-images',\r\n  templateUrl: 'images.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ImagesPage {\r\n  username: any;\r\n  t: Tabs = this.navCtrl.parent;\r\n  lpda_images;\r\n  pda_images;\r\n  images;\r\n  images_present: boolean;\r\n  images_loaded: boolean;\r\n  subscription;\r\n  result = null;\r\n  driverId: number;\r\n  loginFlag = this.pdaParams.isDrvLoggedOn();\r\n  newMessageCount: number;\r\n  logParams = { site: this.pdaParams.getSiteId(), driver: this.pdaParams.getDriverId(), fn: 'ImagesPage' };\r\n  log = this.logger.getInstance(this.logParams);\r\n\r\n  constructor(public navCtrl: NavController, public navParams: NavParams,\r\n    private configService: ConfigServiceProvider, private pdaParams: PdaparamsServiceProvider,\r\n    private imageService: ImageServiceProvider, private siteConfig: SiteconfigServiceProvider,\r\n    private sharedService: SharedServiceProvider, private imageFileService: ImageFileServiceProvider,\r\n    private alertCtrl: AlertController, private messageService: MessageServiceProvider,\r\n    private cd: ChangeDetectorRef, private logger: LogServiceProvider) {\r\n    //console.log(\"ImagesPage loading...\");\r\n    this.username = navParams.data;\r\n    LoopBackConfig.setBaseURL(this.configService.apiURL);\r\n    LoopBackConfig.setApiVersion(this.configService.API_VERSION);\r\n    this.driverId = this.pdaParams.getDriverId();\r\n    //Monitor Image Refreshes.\r\n    this.sharedService.imageRefresh.subscribe(res => {\r\n      this.getImages();\r\n    });\r\n  }//End of the constructor.\r\n\r\n\r\n  ionViewWillEnter() {\r\n\r\n    //set the tab string in shared-service\r\n    this.sharedService.tab = \"Images\";\r\n    this.log.info(\"In the Images Tab.\");\r\n    this.images_loaded = false;\r\n    this.images_present = false;\r\n    if (this.sharedService.testing) {\r\n      this.lpda_images = 'Y';\r\n      this.pda_images = 'Y';\r\n    } else {\r\n      this.lpda_images = this.pdaParams.pda_images ? 'Y' : 'N';\r\n      this.pda_images = this.siteConfig.getSiteConfigYN('PDA_IMAGES');\r\n    }\r\n    if (this.pda_images != 'Y' && this.lpda_images != 'Y') {\r\n      let alert = this.alertCtrl.create({\r\n        title: 'Module not installed',\r\n        subTitle: 'This module is not installed.',\r\n        buttons: [{\r\n          text: 'OK',\r\n          handler: () => {\r\n            const navTransition = alert.dismiss();\r\n            navTransition.then(() => {\r\n              this.t.select(0);\r\n            });\r\n            return false;\r\n          }\r\n        }],\r\n        enableBackdropDismiss: false\r\n      });\r\n      alert.present();\r\n    } else {\r\n      this.getImages();\r\n    }\r\n  }// ionViewWillEnter() ends here\r\n\r\n\r\n  getImages = () => {\r\n    this.imageService.getImageList().subscribe((images) => {\r\n      if (images) {\r\n        var len = images.length;\r\n        if (len > 0)\r\n          this.images_present = true;\r\n        //For each of the images retrieved from file system grab any notes and update the uploaded flag.\r\n        for (var i = 0; i < len; i++) {\r\n          var notes = this.imageFileService.getImageProperty(images[i].name, 'notes');\r\n          if (notes != null) {\r\n            images[i].notes = notes;\r\n          }\r\n          images[i].uploaded = this.imageFileService.getImageProperty(images[i].name, 'uploaded');\r\n          images[i].readyForUpload = this.imageFileService.getImageProperty(images[i].name, 'readyForUpload');\r\n        }\r\n        this.images = images;\r\n        this.images_loaded = true;\r\n        this.cd.detectChanges();\r\n      }\r\n    });\r\n  }//getImages() ends here\r\n\r\n  //Riyaz: See https://github.com/justinwoodcock/Loopback-Upload\r\n  uploadImage = (image) => {\r\n    this.imageService.uploadImage(image, (result) => {\r\n      this.images_loaded = false;\r\n      this.getImages();\r\n    });\r\n  }\r\n\r\n  deleteImage = (imageName) => {\r\n    this.imageService.deleteSingleImage(imageName).subscribe((success) => {\r\n      this.getImages();\t\t// reload images into scope     \r\n    }, function (err) {\r\n      this.log.error(err);\r\n    });\r\n  }\r\n\r\n  deleteObsoleteImages = () => {\r\n    this.imageService.deleteObsoleteImages().subscribe((result) => {\r\n      this.result = result;\r\n      this.navCtrl.setRoot(this.navCtrl.getActive().component);\r\n    }, (err) => {\r\n      //this.log.error(err);\r\n    });\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/images/images.ts"],"sourceRoot":""}